# /etc/nginx/sites-available/founderos
#
# FounderOS — Nginx config
# Serves the web frontend (static) + proxies API to Gunicorn on :8000.
#
# Install:
#   sudo cp nginx-founderos.conf /etc/nginx/sites-available/founderos
#   sudo ln -s /etc/nginx/sites-available/founderos /etc/nginx/sites-enabled/
#   sudo nginx -t && sudo systemctl reload nginx
#
# When you have a domain, add SSL:
#   sudo certbot --nginx -d api.founderos.app

server {
    listen 80 default_server;
    server_name _;

    # ─── Web Frontend (static files) ───────────────────────
    root /var/www/founderos-web;
    index index.html;

    # File uploads up to 50 MB
    client_max_body_size 50M;

    # ─── API proxy (/api/*) ────────────────────────────────
    location /api/ {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # SSE support (streaming chat responses)
        proxy_buffering off;
        proxy_cache off;
        proxy_read_timeout 300s;
        proxy_send_timeout 300s;
    }

    # ─── Static assets (cache them) ───────────────────────
    location /_expo/ {
        expires 30d;
        add_header Cache-Control "public, immutable";
        try_files $uri =404;
    }

    location /assets/ {
        expires 30d;
        add_header Cache-Control "public, immutable";
        try_files $uri =404;
    }

    # ─── SPA fallback ─────────────────────────────────────
    # Any route that doesn't match a file → serve index.html
    location / {
        try_files $uri $uri/ /index.html;
    }

    # Block dotfiles
    location ~ /\. {
        deny all;
        return 404;
    }
}
